<html>
<head>
<title>History of changes for DeuTex</title>
</head>
<body>
<h1>History of changes for DeuTex</h1>

<dl>
<p><dt>DeuTex 4.0.2 (AYM 1999-09-19)
<dd>
	<ul>
	<p><li>CLI: new options
	
	  <ul>
	  <li><code>-doom02</code> (implies <code>-ipf alpha</code>,
	  <code>-itf none</code> and <code>-itl none</code>)

	  <li><code>-doom04</code> (implies <code>-ipf alpha</code>,
	  <code>-itf nameless</code> and <code>-itl textures</code>)

	  <li><code>-doom05</code> (implies <code>-ipf alpha</code> and
	  <code>-itl textures</code>)

	  <li><code>-doompr</code> (implies <code>-ipf pr</code>)

	  </ul>

	<p>Use those options where you would have used <code>-doom</code> and
	friends. For example, to extract the contents of the Doom 0.4 iwad
	that is in <code>c:\doom0_4</code>, type "<code>deutex -doom04
	c:\doom0_4 -xtract</code>".

	<p><li>Code: replaced certain unjustified uses of <code>Int32</code>
	by <code>long</code>.

	<p><li>Doc: removed <code>old/readme.txt</code>. It's so out of date
	that it's more confusing than useful.

	<p><li>Game: Doom alpha and Doom PR: it's now possible to extract
	graphics, patches, sprites and textures from those iwads. Three new
	options&nbsp;:

	  <dl>
	  <dt><code>-ipf {normal|pr|alpha}</code>
	  <dd>Use <code>alpha</code> for Doom alpha 0.2, 0.4 and 0.5.<br>Use
	  <code>pr</code> for Doom PR (press release pre-beta).<br>Use
	  <code>normal</code> for everything else.

	  <dt><code>-itf {normal|nameless|none}</code>
	  <dd>Use <code>none</code> for Doom alpha 0.2.<br>Use
	  <code>nameless</code> for Doom alpha 0.4.<br>Use <code>normal</code>
	  for everything else, including Doom alpha 0.5.

	  <dt><code>-itl {normal|textures|none}</code>
	  <dd>Use <code>none</code> for Doom alpha 0.2.<br>Use
	  <code>textures</code> for Doom alpha 0.4 and 0.5.<br>Use
	  <code>normal</code> for everything else, including Doom alpha 0.5.

	  </dl>

	<p>You shouldn't ever have to use those options directly. It's better
	to use just <code>-doom02</code>, <code>-doom04</code>,
	<code>-doom05</code> and <code>-doompr</code>, which take care of
	setting ipf, itf and itl properly for you.

	<p>Note that extracting levels and some other lumps from the Doom
	alpha iwads does not work yet.

	<p><li>Platform: new target in the makefile to generate a binary DOS
	distribution with the executables and the user documentation in DOS
	format, with DOS-ish names.

	</ul>

<p><dt>DeuTex 4.0.1 (AYM 1999-09-10)
<dd>
	<ul>
	<p><li>CLI: reworked the command line arguments parsing, with
	the following consequences.

	  <ul>
	  <li>Options can now be abbreviated freely, as long as the
	  abbreviation is not ambiguous. For example, you can use
	  <code>-heretic</code>, <code>-hereti</code>, <code>-heret</code>,
	  <code>-here</code> or <code>-her</code> but not <code>-he</code>
	  because that could also be the abbreviation for <code>-help</code>
	  (or <code>-hexen</code>, for that matter). On the other hand,
	  <code>-h</code> <em>is</em> allowed because it's not an abbreviation
	  (there's really a <code>-h</code> option).

	  <li><code>-heretic</code> and <code>-hexen</code> now work (they
	  were "hidden" by <code>-h[elp]</code>). 

	  <li><code>-v<var>@</var></code> has been split in <code>-v0</code>,
	  <code>-v1</code> ... <code>-v5</code> because the new code does not
	  allow excess characters after an option.
	  <code>-v<var>string</var></code> where <var>string</var> is anything
	  else than "<code>0</code>" through "<code>5</code>" now triggers an
	  error (it used to be accepted silently). I hope no one relied on the
	  old undocumented behaviour.

	  <li>Certain silly command line arguments that would have worked
	  before would now trigger an error. For example, it used to be
	  possible to type <code>-extramarital</code> or
	  <code>-extermination</code> for <code>-extract</code> but not
	  anymore. The old code defined relatively short options
	  (<code>-ext</code>) and accepted command line arguments as long as
	  the defined option was an initial substring of the command line
	  argument. The new code does the reverse; it defines relatively long
	  options (<code>-extract</code>) and accepts command line argument as
	  long as they're an initial substring of the defined option.

	  </ul>

	<p><li>Code: replaced direct testing of <code>__MSDOS__</code>,
	<code>__OS2__</code>, <code>__GNUC__</code>,
	<code>__BORLANDC__</code> by <code>DT_CC</code> and
	<code>DT_OS</code>. This is hopefully going to make Udo's job a
	bit easier.

	<p><li>Code: now uses the same <code>fopen()</code> modes for
	all platforms: "<code>{rw}b</code>" for binary mode and
	"<code>{rw}</code>" for text mode, as per the ANSI/ISO C
	standard. This will fix the problem Udo Munk reported with the
	Cygwin build opening binary files in text mode and thus failing
	miserably. Note that certain DOS C compilers can be configured
	so that "<code>{rw}</code>" opens files in <em>binary</em> mode.
	Don't do that&nbsp;! If you have problems with text files on
	DOS, make sure your C compiler is configured so that
	"<code>{rw}</code>" opens files in <em>text</em> mode.

	<p><li>Code: added to the distribution archive
	<code>gifcodec.c</code> that I had forgotten to include (it's
	not used anyway).

	<p><li>Code: added to the distribution archive
	<code>src/{deusf,deusfos,deutex,deutexos}.def</code> that I had
	forgotten to include. I guess that's Windows/OS/2-only stuff.

	<p><li>Doc: updated <code>making.txt</code> and renamed it as
	<code>INSTALL</code> for homogeneity. Removed obsolete reference
	to <code>alpha.sh</code> and the file itself.

	<p><li>Doc: made more legal updates.

	<p><li>Doc: documented <code>DOOMWADDIR</code> in the man page.

	<p><li>Misc: changed the default graphics format for Unix from
	GIF to PPM, so that fewer user sites are broken if and when GIF
	support is removed. For the same reason, added a warning message
	when <code>-gif</code> is used or the first time an image is
	read from a GIF file.

	<p><li>Misc: changed the lookup order for images to PPM, BMP,
	GIF (was BMP, GIF, PPM).

	<p><li>Platform: fixed a couple of things that didn't work on
	16-bit platforms (real-mode DOS).

	<p><li>Platform: now compiles on DOS with Borland C++ 4.0.
	
	<p><li>Platform: now compiles on DOS with MSC 6.0. The MSC 6.0
	build is functional but limited because it can't allocate blocks
	larger than 64 kB, which is insufficient for certain images. I
	can't use <code>halloc()</code> instead of <code>malloc()</code>
	because it does not supporting resizing (i.e. there's no
	<code>hrealloc()</code> function).

	<p><li>Platform: in response to Udo's remarks, DJGPP and Cygwin
	are now properly identified (<code>__DJGPP__</code> and
	<code>__CYGWIN__</code>).

	<p><li>Platform: added sanity checks on specified-size types
	<code>Int32</code> and friends.

	</ul>

<p><dt>DeuTex 4.0.0a3 (AYM 1999-09-05)
<dd>
	<ul>
	<p><li>Code: removed incongruous <code>#define</code>-ing of
	<code>O_BINARY</code> and <code>SEEK_SET</code>.

	<p><li>Code: after Udo Munk's report, fixed warnings in
	  <ul>
	  <li><code>src/color.c(74)</code>
	  <li><code>src/ident.c(583)</code>
	  <li><code>src/ident.c(658)</code>
	  <li><code>src/mkwad.c(78)</code>
	  <li><code>src/mkwad.c(79)</code>
	  <li><code>src/mkwad.c(80)</code>
	  <li><code>src/mkwad.c(81)</code>
	  <li><code>src/picture.c(903)</code>
	  <li><code>src/picture.c(912)</code>
	  </ul>

	<p><li>Doc: updated <code>making.txt</code>.

	<p><li>Legal: as agreed to by Olivier Montanuy, DeuTex is now
	entirely GPL'd. Well, <em>almost</em> entirely, since it
	includes code written by different authors in <code>lzw.c</code>
	and elsewhere. Changed the notices in the source files and added
	new file <code>LICENSE</code> to clarify things.

	<p><li>Makefile: should now work with all C compilers (removed
	<code>-Wall</code> from <code>CFLAGS</code>).

	<p><li>Makefile: <code>clean</code> now removes the DOS
	executables if they exist.

	<p><li>Makefile: does not compile with debug information in by
	default anymore.

	<p><li>Makefile: new targets <code>dall</code>,
	<code>ddt</code>, <code>dds</code>, <code>ddeutex</code>
	and <code>ddeusf</code> for compiling with debug
	information and all warnings.

	<p><li>Makefile: new target <code>help</code>.

	<p><li>Makefile: new target <code>distdos</code>.

	<p><li>Platform: replaced <code>unlink()</code> by
	<code>remove()</code> for portability. Thanks to Udo for
	reporting this.

	<p><li>Platform: on 8.3 filesystems, make should not choke on
	<code>docsrc/changes.html</code> anymore. Thanks to Udo for
	reporting this.

	<p><li>Sound: corrected some misleading endianness
	comments in <code>sound.c</code>.

	</ul>

<p><dt>DeuTex 4.0.0a2 (AYM 1999-08-14)
<dd>
	<ul>
	<p><li>Game: easier to use with Strife (now looks for
	"<code>strife1.wad</code>", new option "<code>-strife</code>").

	<p><li>Game: easier to use with Hexen (new option
	"<code>-hexen</code>").

	<p><li>Command line: new options "<code>-hexen</code>" and
	"<code>-strife</code>".

	<p><li>Command line: new option "<code>--version</code>" (prints
	version number and returns 0).

	<p><li>Doc: various changes in the man page, in the output of
	"<code>-help</code>" and "<code>-man</code>" and elsewhere.

	<p><li>Makefile: various improvements.

	<p><li>Distribution: set modes straight.

	</ul>

<p><dt>DeuTex 4.0.0a1 (AYM 1999-08-12)
<dd>
	<ul>
	<p><li>General: fixed many segfaults that were caused by
	attempts to <code>fclose (NULL)</code>.

	<p><li>Game: Strife is now supported.

	<p><li>Wad: new options <code>-be</code>, <code>-le</code>,
	<code>-ibe</code>, <code>-ile</code>, <code>-obe</code> and
	<code>-ole</code> to control the endianness of the wads.
	<strong>Caution</strong>: don't use them if you don't know what
	you're doing&nbsp;! As far as I know, wads are always
	little-endian regardless of the architecture of the host.
	Therefore, I see no reason for someone in his/her right mind to
	create a big-endian wad. Those options are here more for the
	sake of completeness than anything else.

	<p><li>Wad: made "<code>%</code>" legal in names, to deal with
	Strife's "<code>INVFONG%</code>" and
	"<code>INVFONY%</code>".</p>

	<p><li>Wad, graphics: end-of-flats marker is now
	<code>F_END</code> by default instead of <code>FF_END</code>.
	The reason for this change is that, with <code>F_END</code>, you
	don't need DeuSF to get Doom to see your new flats. Should you
	need to, it's still possible to get <code>FF_END</code> by using
	<code>-fend</code>.

	<p><li>Graphics: the default transparent colour is now a dark
	blue-green (rgb:00/2f/2f). It used to be cyan (rgb:00/ff/ff)
	which was blindingly bright, especially compared to the usually
	dark colours used in Doom textures. It's no fun to tweak shades
	of dark brown on a cyan background.

	<p>To reuse images done with/for a previous version of DeuTex,
	you need to either invoke DeuTex with "<code>-rgb 0 255
	255</code>" or convert your images by replacing all occurrences
	of colour (0, 255, 255) by colour (0, 47, 47). To preserve
	compatibility with WinTex, I didn't change the default
	transparent colour in WinTex mode&nbsp;; it's still (0, 255,
	255).

	<p><li>Graphics: fixed segfaults due to bug in conversion of
	bitmap images to Doom pictures. Occured in certain 2-pixel high
	images such as <code>STBFN045</code> in the Strife iwad.

	<p><li>Graphics: now supports pictures and textures up to 509
	high (was limited to 128).

	<p><li>Graphics: now supports pictures and textures up to 1024
	wide (was limited to 512).

	<p><li>Graphics: new option "<code>-pf</code>" to deal with the
	different picture format in the Doom alpha iwad (the underlying
	functionality is not implemented yet !)

	<p><li>Graphics: using <code>-ppm</code> does not cause anymore
	DeuTex to abort with "<code>Bug: *** psvit ***</code>".

	<p><li>Graphics: fixed "<code>-ppm</code>" message.

	<p><li>Sound, platform: a bug that must have prevented reading
	<code>.wav</code> files on big endian machines has been
	squashed.

	<p><li>Command line: options can't start with a slash
	("<code>/</code>") anymore. I don't think anyone used it and was
	a silly feature for a Unix program.

	<p><li>Command line: not case insensitive anymore.
	
	<p><li>Command line: changed the wording of error messages to
	use "option" instead of "command".

	<p><li>Command line: added options "<code>-?</code>" and
	"<code>--help</code>" as synonyms for "<code>-help</code>".

	<p><li>Doc: new option "<code>-man</code>" to print help in
	<code>troff -man</code> source format for inclusion in the man
	page.

	<p><li>Doc: the version number is now a free-form string.

	<p><li>Doc: Made on-line help more compact.

	<p><li>Doc: updated "<code>making.txt</code>".

	<p><li>Doc: made a proper <code>README</code> file.

	<p><li>Makefile: renamed "<code>unix</code>" target as
	"<code>strip</code>".

	<p><li>Makefile: new target "<code>install</code>".

	<p><li>Makefile: new target "<code>dist</code>".

	<p><li>Platform: reworked the handling of endianness. DeuTex
	used to deal with that through a set of macros that swapped
	bytes whenever the required endianness was not the same as the
	native endianness. To known the native endianness, DeuTex relied
	on a macro defined via <code>-D</code>.

	<p>There were two problems with this scheme. Firstly, Olivier
	got the meaning of "little endian" and "big endian" backwards
	and defining <code>LITTLE_ENDIAN</code> in fact caused DeuTex to
	believe it was being compiled for a big endian machine. As the
	glibc headers happen to define <code>LITTLE_ENDIAN</code> if the
	machine is little endian, compiling DeuTex on a glibc little
	endian Linux system was impossible unless you made changes to
	the source.

	<p>The other, more fundamental, objection against the old
	approach is that, as it needed the user to tell it about the
	native endianness by modifying the makefile, it prevented
	unattended builds and made things difficult for naive users.

	<p>The new method eliminates this problem by using a different
	algorithm that does not need to know the native endianness. The
	end result is that you don't have to worry about endianness
	anymore.

	<p><li>Internal: in <code>TXTinit()</code>, removed useless
	"<code>% 0xFF</code>" in index of <code>TXTval</code>.

	</ul>

</dl>

</body>
</html>
